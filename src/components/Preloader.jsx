import React, { useRef } from 'react';
import { gsap } from 'gsap';
import { DrawSVGPlugin } from 'gsap/DrawSVGPlugin';
import { useGSAP } from '@gsap/react';

gsap.registerPlugin(DrawSVGPlugin);

// ✅ As requested, the new long SVG path data is a placeholder.
// You can paste the full path data here manually.
const preloaderPathPlaceholder = "M 353.379 298.405 C 352.449 297.853 351.472 297.381 350.526 296.861 C 345.386 294.072 340.293 291.221 334.948 288.857 C 333.86 288.369 333.292 287.754 333.419 286.51 C 333.986 281.185 334.491 275.844 335.074 270.518 C 335.248 268.927 335.516 268.801 336.887 269.541 C 341.097 271.81 345.512 273.543 350.1 274.867 C 350.715 275.04 351.345 275.339 352.039 274.914 C 351.882 274.426 351.566 274.3 351.267 274.158 C 344.976 270.897 339.032 267.084 333.356 262.893 C 326.923 258.135 320.742 253.03 314.971 247.469 C 310.305 242.963 305.748 238.331 301.522 233.384 C 296.083 227.003 291.085 220.307 286.181 213.501 C 283.454 209.704 282.003 205.875 282.508 201.196 C 282.76 198.817 280.899 197.431 278.487 197.793 C 277.131 197.998 276.154 198.754 275.365 199.794 C 274.64 200.739 273.741 201.259 272.543 201.48 C 269.248 202.094 265.814 202.228 262.704 203.48 C 261.817 203.837 260.507 203.405 259.346 201.747 C 257.977 199.792 255.026 202.157 255.105 204.63 C 255.184 206.631 254.474 208.175 253.165 209.578 C 251.037 211.846 248.814 214.036 246.386 215.958 C 238.865 221.93 230.635 226.767 222.105 231.115 C 216.224 234.108 210.138 236.661 204.084 239.26 C 203.642 239.449 203.043 239.465 202.869 240.095 C 203.264 240.505 203.658 240.237 204.052 240.127 L 208.12 238.945 C 218.415 235.92 228.396 232.139 237.746 226.845 C 243.201 223.757 248.483 220.401 253.26 216.305 C 254.269 215.438 254.458 215.549 254.647 216.872 C 255.026 219.472 254.459 220.685 252.156 222.056 C 251.746 222.292 251.368 222.56 250.974 222.828 C 243.816 227.838 236.264 232.155 228.207 235.589 C 219.298 239.386 210.154 242.411 200.615 244.207 C 195.932 245.09 191.265 245.972 186.535 246.492 C 177.028 247.547 167.489 248.052 157.934 248.257 C 157.209 248.257 156.452 248.257 155.821 248.729 C 156.089 249.312 156.562 249.28 156.956 249.359 C 161.813 250.383 166.748 250.84 171.683 251.029 C 178.462 251.313 185.242 251.203 191.99 250.368 C 193.11 250.226 193.472 250.635 193.409 251.659 C 193.267 253.912 193.078 256.166 193.11 258.418 C 193.126 259.821 193.189 261.239 192.952 262.641 C 192.81 263.413 192.448 263.775 191.643 263.807 C 190.193 263.838 188.726 264.027 187.276 264.027 C 177.642 264.027 168.103 265.099 158.612 266.643 C 150.965 267.887 143.555 270.093 136.286 272.756 C 135.876 272.897 135.151 272.96 135.23 273.496 C 135.308 274.174 136.05 273.984 136.523 273.984 C 138.793 274.016 141.032 273.717 143.271 273.37 C 148.206 272.614 153.125 271.779 158.092 271.212 C 165.297 270.408 172.566 270.298 179.803 270.093 C 186.377 269.904 192.968 269.636 199.574 269.92 C 206.764 270.219 213.969 270.455 221.175 270.629 C 224.896 270.723 228.601 270.991 232.306 271.275 C 238.502 271.763 244.683 272.346 250.879 272.834 C 253.055 273.008 259.898 273.764 261.033 273.921 C 264.581 274.378 268.144 274.757 271.692 275.15 C 272.48 275.245 281.041 276.679 283.879 277.309 C 283.974 277.309 302.358 281.437 311.298 284.099 C 318.204 286.148 325.094 288.274 331.874 290.732 C 339.142 293.363 346.253 296.372 353.411 299.303 C 353.695 299.413 353.979 299.697 354.31 299.35 C 354.262 298.783 353.726 298.641 353.364 298.421 L 353.379 298.405 Z M 209.555 262.704 C 209.555 263.744 209.113 264.138 208.104 264.09 C 206.921 264.043 205.755 264.09 204.572 264.09 C 201.986 264.248 199.416 263.728 196.815 263.807 C 195.885 263.838 195.632 263.413 195.664 262.515 C 195.743 258.844 196.027 255.204 196.216 251.534 C 196.279 250.21 196.862 249.706 198.029 249.47 C 200.993 248.902 203.926 248.272 206.89 247.736 C 210.264 247.138 210.138 247.169 210.17 250.604 C 210.217 254.653 209.507 258.655 209.539 262.704 L 209.555 262.704 Z M 225.4 243.388 C 225.195 246.618 224.265 261.68 224.265 261.68 C 224.218 263.87 222.972 264.941 220.528 264.925 C 218.825 264.831 216.65 264.721 214.489 264.61 C 213.276 264.547 212.566 264.138 212.661 262.72 C 213.007 257.52 213.276 252.306 213.575 247.091 C 213.622 246.224 214.111 245.704 214.899 245.436 C 218.037 244.412 221.175 243.404 224.297 242.38 C 225.306 242.049 225.447 242.632 225.4 243.388 Z M 239.764 237.606 C 239.496 241.498 239.18 245.389 238.897 249.28 C 238.628 253.077 238.376 256.874 238.124 260.671 C 238.045 261.837 237.872 263.019 237.888 264.185 C 237.888 265.429 237.383 265.902 236.185 265.792 C 235.759 265.744 231.06 265.556 229.121 265.461 C 227.86 265.398 227.277 264.846 227.371 263.492 C 227.844 257.253 228.822 244.113 228.774 243.798 C 228.333 241.356 229.452 240.127 231.739 239.402 C 233.962 238.693 236.074 237.59 238.234 236.629 C 239.59 236.03 239.858 236.172 239.764 237.606 Z M 254.506 229.161 C 254.506 229.87 254.506 230.579 254.506 231.272 C 253.828 240.19 253.985 249.123 253.607 258.04 C 253.497 260.577 253.418 263.113 253.402 265.65 C 253.402 266.816 252.976 267.289 251.81 267.178 C 248.577 266.863 245.361 266.548 242.129 266.264 C 240.741 266.139 240.552 265.272 240.726 264.185 C 241.372 260.01 241.309 255.772 241.829 251.565 C 242.381 247.138 242.586 242.679 242.949 238.236 C 243.043 237.165 243.154 236.078 243.28 235.007 C 243.343 234.392 243.658 233.966 244.194 233.667 C 247.221 231.934 250.233 230.201 253.244 228.452 C 254.111 227.948 254.553 228.074 254.522 229.161 L 254.506 229.161 Z M 263.792 208.175 C 265.369 207.986 266.867 207.356 268.775 207.34 C 267.892 208.695 266.82 209.452 265.826 210.271 C 265.369 210.649 263.635 208.191 263.792 208.175 Z M 263.225 221.599 C 263.745 221.299 264.202 220.874 264.691 220.496 C 266.552 219.094 266.536 219.11 268.097 220.779 C 269.721 222.528 271.408 224.214 273.048 225.947 C 274.041 227.003 273.899 227.412 272.401 227.743 C 269.185 228.421 265.968 229.083 262.736 229.729 C 261.002 230.075 260.749 229.854 260.733 228.09 L 260.733 226.168 C 260.134 224.183 261.254 222.686 263.209 221.599 L 263.225 221.599 Z M 258.731 215.754 L 258.731 211.941 L 260.844 213.847 L 258.731 215.754 Z M 273.189 254.338 C 273.048 259.175 272.795 264.011 272.89 268.848 C 272.89 269.683 272.496 269.888 271.739 269.778 C 268.16 269.258 264.581 268.77 260.986 268.265 C 260.087 268.139 259.882 267.541 259.882 266.753 L 259.882 261.68 L 259.93 261.68 C 259.93 260.041 259.93 258.387 259.93 256.749 C 259.93 255.598 260.481 255.031 261.569 254.826 C 264.896 254.228 268.239 253.629 271.55 252.983 C 272.779 252.747 273.221 253.204 273.189 254.354 L 273.189 254.338 Z M 273.725 234.03 C 273.694 235.069 273.725 236.093 273.725 237.133 L 273.457 246.019 C 273.457 246.98 273 247.5 272.086 247.689 C 268.57 248.398 265.07 249.107 261.569 249.832 C 260.56 250.037 260.245 249.422 260.308 248.619 C 260.623 244.617 260.403 240.615 260.481 236.613 C 260.481 235.652 260.828 235.148 261.806 234.975 C 265.322 234.329 268.838 233.636 272.338 232.927 C 273.347 232.722 273.757 233.006 273.725 234.03 Z M 273.994 218.936 C 273.994 219.204 273.189 219.582 273 219.393 C 272.259 218.605 271.518 217.817 270.793 217.014 C 270.383 216.557 270.414 216.053 270.793 215.596 C 271.502 214.73 272.259 213.879 273 213.028 C 273.174 212.823 273.978 213.17 273.994 213.438 L 273.994 218.936 Z M 291.826 247.327 C 291.211 253.471 291.305 259.695 290.754 265.886 C 290.564 267.95 290.486 270.014 290.438 272.078 C 290.407 273.149 289.997 273.496 288.94 273.26 C 286.828 272.771 284.715 272.315 282.587 271.873 C 281.341 271.621 280.757 270.975 280.805 269.62 C 281.167 258.434 281.293 247.232 281.404 236.03 C 281.404 235.668 281.278 235.195 281.703 235.022 C 282.129 234.849 282.366 235.29 282.618 235.526 C 284.936 237.653 287.206 239.843 289.603 241.907 C 291.29 243.357 292.425 244.932 291.841 247.311 L 291.826 247.311 L 291.826 247.327 Z M 292.015 238.835 C 291.242 239.103 290.643 237.874 290.044 237.259 C 287.569 234.754 285.157 232.17 282.681 229.65 C 281.972 228.925 281.625 228.137 281.64 227.129 C 281.672 225.711 281.64 224.309 281.64 222.891 L 281.672 222.891 L 281.672 218.227 C 281.672 217.959 281.625 217.597 281.956 217.487 C 282.287 217.377 282.444 217.707 282.602 217.912 C 285.913 222.308 289.382 226.593 292.314 231.241 C 293.245 232.722 292.677 234.66 292.519 236.377 C 292.441 237.212 292.803 238.551 291.999 238.819 L 292.015 238.835 Z M 306.237 257.174 C 305.653 263.303 305.369 269.163 305.07 275.024 C 305.07 275.45 304.455 277.34 303.651 277.12 C 300.671 276.269 297.675 275.45 294.68 274.646 C 293.844 274.426 293.592 274 293.655 273.118 C 294.301 265.067 295.279 257.048 295.547 248.965 C 295.547 248.65 295.452 248.241 295.783 248.052 C 296.209 247.799 296.477 248.225 296.745 248.445 C 299.567 250.714 302.374 252.999 305.18 255.283 C 305.858 255.835 306.363 256.512 306.237 257.189 L 306.237 257.174 Z M 306.505 249.533 C 306.505 249.533 306.536 252.573 306.237 252.731 C 305.921 252.888 305.716 252.621 305.511 252.432 C 302.61 249.627 299.694 246.823 296.808 244.018 C 296.304 243.53 296.083 242.931 296.162 242.222 C 296.319 240.678 296.477 239.15 296.666 237.606 C 296.698 237.385 296.777 237.102 296.918 237.007 C 297.218 236.803 297.439 237.086 297.628 237.291 C 299.284 239.071 300.939 240.883 302.61 242.648 C 303.351 243.435 304.077 244.223 304.896 244.932 C 306.41 246.224 306.883 247.815 306.505 249.533 Z M 318.897 267.005 C 318.393 271.259 318.409 275.544 318.125 279.814 C 317.999 281.594 317.873 281.783 316.233 281.248 C 313.6 280.381 310.982 279.452 308.349 278.569 C 307.072 278.144 307.482 277.073 307.356 275.844 C 308.176 272.299 307.671 268.297 308.381 264.39 C 308.681 262.735 308.696 261.018 308.775 259.332 C 308.822 258.466 309.106 258.324 309.784 258.828 C 312.559 260.845 315.35 262.861 318.141 264.878 C 318.897 265.429 318.992 266.17 318.897 267.021 L 318.897 267.005 Z M 319.292 259.947 C 319.181 260.829 319.102 261.711 318.976 262.594 C 318.929 262.987 319.15 263.555 318.645 263.712 C 318.219 263.838 312.827 259.001 310.399 257.001 C 309.453 256.213 308.917 255.346 309.09 254.086 C 309.201 253.251 309.232 252.4 309.327 251.565 C 309.39 251.061 309.122 250.336 309.579 250.131 C 310.115 249.895 310.557 250.541 310.967 250.888 C 313.348 252.936 315.697 255.031 318.077 257.095 C 318.96 257.867 319.449 258.749 319.292 259.947 Z M 331.353 285.58 C 331.274 286.73 330.912 287.171 329.682 286.62 C 326.891 285.391 324.053 284.257 321.215 283.107 C 320.411 282.776 319.875 282.398 320.048 281.342 C 320.837 276.474 320.6 271.511 321.357 266.611 C 321.593 265.083 321.53 263.444 321.578 261.853 C 321.625 260.467 322.051 260.278 323.217 261.049 C 325.929 262.814 328.61 264.658 331.369 266.343 C 332.772 267.21 332.551 268.439 332.583 269.699 C 332.173 274.993 331.763 280.271 331.369 285.565 L 331.353 285.58 Z";

const Preloader = ({ isLoaded, onExitComplete }) => {
    const preloaderRef = useRef(null);
    const pathsRef = useRef([]);
    const timeline = useRef();

    useGSAP(() => {
        // The looping animation logic remains the same
        timeline.current = gsap.timeline({ repeat: -1, yoyo: true });
        
        timeline.current.fromTo(pathsRef.current, 
            { drawSVG: "0%" },
            { 
                drawSVG: "100%", 
                duration: 2.5, 
                stagger: 0.2,
                ease: "power1.inOut" 
            }
        );
    }, { scope: preloaderRef });

    // The exit logic remains the same
    useGSAP(() => {
        if (isLoaded) {
            if (timeline.current) {
                timeline.current.repeat(0);
            }

            gsap.to(preloaderRef.current, {
                autoAlpha: 0,
                duration: 0.8,
                delay: timeline.current ? timeline.current.duration() : 0,
                ease: 'power2.inOut',
                onComplete: () => {
                    onExitComplete?.(); 
                }
            });
        }
    }, { dependencies: [isLoaded] });

    return (
        <div ref={preloaderRef} className="fixed inset-0 z-[1000] h-screen flex items-center justify-center bg-background">
            {/* ✅ The SVG has been replaced with your new version */}
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="135.224 197.7359 219.086 170.4801" width="219.086px" height="170.48px">
                {/* The paths have been updated to use stroke for the drawing animation */}
                <path 
                    ref={el => pathsRef.current[0] = el}
                    d="M 281.41 276.762 L 281.609 368.216 L 272.354 368.216 L 272.367 275.199 L 281.41 276.762 Z" 
                    fill="none" 
                    stroke="var(--color-accent)"
                    strokeWidth="1"
                />
                <path 
                    ref={el => pathsRef.current[1] = el}
                    d="M 260.834 273.826 L 260.834 368.2 L 251.53 368.2 L 251.53 272.852 L 260.834 273.826 Z" 
                    fill="none" 
                    stroke="var(--color-accent)"
                    strokeWidth="1"
                />
                <path 
                    ref={el => pathsRef.current[2] = el}
                    d={preloaderPathPlaceholder} 
                    fill="none" 
                    stroke="var(--color-accent)"
                    strokeWidth="1"
                />
            </svg>
        </div>
    );
};

export default Preloader;